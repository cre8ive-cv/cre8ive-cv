/* Mode Loading Screen - Elegant transition overlay */
#mode-loader {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: var(--bg-primary, #1e2127);
  z-index: 999999;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 1;
  transition: opacity 0.4s ease-out;
}

#mode-loader.loaded {
  opacity: 0;
  pointer-events: none;
}

.loader-bar {
  width: 200px;
  height: 3px;
  background: var(--border-color, #3d4148);
  border-radius: 2px;
  overflow: hidden;
  position: relative;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

.loader-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: var(--accent-primary, #64B5F6);
  animation: loader-progress 0.8s ease-out forwards;
  box-shadow: 0 0 12px var(--accent-primary, #64B5F6);
}

@keyframes loader-progress {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}
/* Mobile and Tablet Responsive Styles */
.mobile-only-label {
  display: none;
}

@media (max-width: 1024px) {
  html {
    overflow-x: hidden;
  }

  body {
    overflow-y: auto;
    overflow-x: hidden;
  }

  .container {
    flex-direction: column;
    height: auto;
    overflow-x: hidden;
    width: 100%;
    max-width: 100%;
  }

  .sidebar {
    width: 100%;
    max-width: 100%;
    height: auto;
    overflow-y: auto;
    overflow-x: hidden;
    border-right: none;
    border-bottom: 1px solid var(--border-color);
    padding: calc(24px + env(safe-area-inset-top, 0px)) 16px 10px;
    gap: 6px;
    /* Create a stacking context above the main content so the gallery
       dropdown (which overflows below the sidebar) paints on top.
       Must be > .dropup-menu (z-index: 5) which lives in the root context. */
    position: relative;
    z-index: 10;
  }

  /* Slightly reduce top padding in Editor tab to match Preview positioning */
  body:not(.mobile-preview-mode) .sidebar {
    padding: calc(18px + env(safe-area-inset-top, 0px)) 16px 10px;
  }

  .control-section.editor-section {
    flex: 0 0 auto;
    overflow: visible;
  }

  .sidebar-scroll {
    width: 100%;
    max-width: 100%;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .json-editor-container {
    flex: 0 0 auto;
    min-height: 300px;
  }

  #jsonEditor {
    min-height: 300px;
    resize: vertical;
  }

  .main-content {
    height: auto;
    min-height: 60vh;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    /* Hide scrollbar while keeping scroll functionality */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  .main-content::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  .preview-container {
    min-height: 60vh;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    /* Hide scrollbar while keeping scroll functionality */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  .preview-container::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Button group adjustments for tablet */
  .button-group {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  /* Main control buttons on tablet - 2-column grid */
  .button-group.button-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    align-items: end;
  }

  .button-group.button-row .button-with-label:first-child {
    grid-column: 1;
  }

  .button-group.button-row .photo-upload-wrapper {
    grid-column: 2;
  }

  .button-group.button-row .button-with-label:last-child {
    grid-column: 1 / -1;
  }

  .button-group.button-row .button-with-label,
  .button-group.button-row .photo-upload-wrapper {
    width: 100%;
    max-width: 100%;
  }

  .button-group.button-row .btn,
  .button-group.button-row .file-btn {
    width: 100%;
  }

  /* Hide label on tablet for cleaner layout */
  .button-group.button-row .button-label {
    display: none;
  }

  .button-group.button-row .button-label.mobile-only-label {
    display: block;
  }

  /* Keep photo upload aspect ratio label visible on all layouts */
  .button-group.button-row #photoUploadLabel {
    display: block;
  }

  .button-group.button-row .button-with-label:last-child {
    display: none;
  }

  .button-group.button-row {
    display: none;
  }

  .control-section {
    gap: 6px;
    margin-bottom: 12px;
  }

  .mobile-view-toggle-container {
    margin-top: 0;
    padding: 3px;
  }

  .mobile-view-option {
    padding: 10px 12px;
    font-size: 14px;
  }

  .mobile-editor-actions {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    margin-top: 0;
    justify-items: stretch;
    align-items: end;
  }

  .mobile-editor-actions > * {
    min-width: 0;
    width: 100%;
  }

  .mobile-editor-actions .button-label {
    display: none;
  }

  /* Keep photo upload aspect ratio label visible on all layouts */
  .mobile-editor-actions #photoUploadLabel {
    display: block;
  }

  .mobile-editor-actions .photo-upload-wrapper {
    width: 100%;
    justify-content: flex-end;
    align-items: stretch;
    gap: 8px;
  }

  .mobile-editor-actions .photo-upload-btn,
  .mobile-editor-actions .photo-remove-btn {
    width: 100%;
  }

  .sidebar-header {
    margin-bottom: 0;
    padding-bottom: 0;
  }

  .logo-grid {
    gap: 6px;
    padding-top: 6px;
  }

  .logo-main {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }

  /* Keep mobile headers aligned consistently between Editor/Preview */
  .logo-heading {
    transform: none;
  }

  .header-actions {
    transform: none;
    gap: 24px;
    flex-wrap: nowrap;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 0;
  }
  .header-actions .mode-switcher {
    position: absolute;
    top: -100px;
    right: 12px;
    margin-left: 0;
    padding-right: 0;
    z-index: 3000;
    transform: none;
  }

  .logo-links-row {
    margin-top: 2px;
  }

  .header-actions .gallery-dropdown-wrapper {
    flex: 1 1 0;
    width: auto; /* flex-basis:0 governs flex context; auto fills grid cells correctly */
    min-width: 0;
    max-width: none;
  }

  .header-actions .gallery-link,
  .mobile-import-json-btn {
    display: flex;
    padding: 8px 10px;
    font-size: 14px;
    height: 40px;
    min-height: 40px;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1 1 0;
    width: 100%;
    max-width: none;
    min-width: 0;
    white-space: nowrap;
    font-weight: 600;
  }

  .header-actions .gallery-link i,
  .mobile-import-json-btn i {
    font-size: 15px;
    flex-shrink: 0;
  }

  .header-actions .mode-switcher-toggle {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    border-width: 2px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .header-actions .mode-switcher-toggle svg {
    width: 24px;
    height: 24px;
  }

  .header-actions .mode-switcher-toggle img.mode-switcher-icon-img {
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }

  .header-actions .mode-switcher-menu {
    right: 0;
    left: auto;
    top: calc(100% + 12px);
    transform: translateY(-8px);
  }

  .header-actions .mode-switcher:hover .mode-switcher-menu,
  .header-actions .mode-switcher:focus-within .mode-switcher-menu,
  .header-actions .mode-switcher.open .mode-switcher-menu {
    transform: translateY(0);
  }

  .header-actions .mode-switcher.closing .mode-switcher-menu {
    transform: translateY(-8px) !important;
  }

  .header-actions .logo-link-text,
  .mobile-import-text {
    display: inline-block;
    max-width: 180px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: bottom;
  }

  /* Appearance grid wrapping */
  .appearance-grid {
    flex-wrap: wrap;
  }

  .appearance-toolbar .stacked-label {
    padding-top: 2px;
  }

  /* Skills list responsiveness */
  .skills-list {
    flex-direction: column;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    flex: 1;
    min-height: 0;
    width: 100%;
    align-items: stretch;
  }

  .skills-list .skill-list-item-row {
    width: 100%;
    flex: 1 1 auto;
  }

  .skills-list .skill-list-item {
    width: 100%;
  }

  .skill-list-item-row {
    flex: 1 0 auto;
  }

  /* Projects list adjustments */
  .projects-list {
    grid-template-columns: 1fr;
  }

  /* Experience/Education card width */
  .experience-list-container {
    --experience-card-width: 50%;
  }
}

@media (max-width: 768px) {
  .sidebar {
    padding: 16px;
    gap: 16px;
  }

  .logo-title {
    font-size: 28px;
  }

  .logo-subtitle {
    font-size: 18px;
  }

  .control-section {
    gap: 10px;
  }

  .main-content {
    padding: 16px;
  }

  .logo-links-row {
    flex-direction: row;
    align-items: center;
    gap: 8px;
  }

  /* Button group full width on mobile */
  .button-group {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* Form rows single column */
  .form-row {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* Skill items single column */
  .skill-items-list {
    grid-template-columns: 1fr;
    gap: 8px;
  }

  /* Skill weight row adjustments */
  .skill-weight-row {
    grid-template-columns: 140px 1fr auto;
    gap: 8px;
  }

  /* Appearance grid full width */
  .appearance-grid {
    grid-template-columns: 1fr;
    gap: 12px;
    align-items: stretch;
  }

  .appearance-grid .select-input,
  #colorSelect.select-input {
    width: 100%;
    max-width: none;
  }

  .watermark-checkbox-inline {
    max-width: none;
  }

  /* Projects list mobile */
  .projects-list {
    grid-template-columns: 1fr;
  }

  /* Add buttons full width */
  #addProjectBtn,
  #addExperienceBtn,
  #addEducationBtn {
    width: 100%;
    max-width: none;
  }

  /* Skills weights panel */
  .skills-weights-panel {
    width: 100%;
    max-width: none;
  }

  /* Experience card full width on mobile */
  .experience-list-container {
    --experience-card-width: 95%;
  }

  .experience-age-pill {
    position: static;
    transform: none;
    margin-bottom: 8px;
  }

  .experience-list-item-row {
    flex-direction: column;
    align-items: stretch;
  }

  /* Export row stacked */
  .export-row {
    flex-direction: column;
    gap: 8px;
  }

  .export-row .btn {
    width: 100%;
  }

  .mobile-preview-actions .export-row {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px;
  }

  .mobile-preview-actions .export-row .export-html-btn,
  .mobile-preview-actions .export-row .export-json-btn {
    margin-bottom: 100px;
  }

  .mobile-preview-actions .export-row .preview-pdf-btn {
    grid-column: 1 / -1;
  }

}

/* =========================================
   Mobile Optimization Enhancements
   ========================================= */

/* Tablet & Mobile - Modal Fixes */
@media (max-width: 960px) {
  /* Override fixed widths and heights */
  #projectsModal .modal-content,
  #projectFormModal .modal-content,
  #experienceModal .modal-content,
  #experienceFormModal .modal-content,
  #educationModal .modal-content,
  #educationFormModal .modal-content,
  #skillsModal .modal-content,
  #skillFormModal .modal-content,
  #gdprModal .modal-content {
    width: 96% !important;
    max-width: 96% !important;
    min-width: 0 !important;
    height: 90vh !important;
    max-height: 90vh !important;
    height: 90dvh !important;
    max-height: 90dvh !important;
    margin: auto;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Specific sizing for Personal Info Modal - Shorter height with more bottom spacing */
  #personalInfoModal .modal-content {
    width: 96% !important;
    max-width: 96% !important;
    min-width: 0 !important;
    height: 90vh !important;
    max-height: 90vh !important;
    height: 90dvh !important;
    max-height: 90dvh !important;
    margin: auto !important;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  #personalInfoModal .modal-content {
    height: 90vh !important;
    max-height: 90vh !important;
    height: 90dvh !important;
    max-height: 90dvh !important;
  }

  /* Ensure modal header and footer are fixed, and body is scrollable */
  .modal-header {
    flex-shrink: 0;
    padding: 12px 16px !important;
    position: sticky;
    top: 0;
    background: var(--bg-secondary);
    z-index: 2;
  }

  .modal-footer {
    flex-shrink: 0;
    margin-top: 0 !important;
    padding: 12px 16px !important;
    background: var(--bg-secondary);
    border-top: 1px solid var(--border-color);
    position: sticky;
    bottom: 0;
    z-index: 2;
    padding-bottom: env(safe-area-inset-bottom);
  }

  .modal-body {
    flex: 1 1 auto !important;
    overflow-y: auto !important;
    padding: 16px !important;
    max-height: none !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: flex-start !important;
    align-items: stretch !important;
  }

  /* Form width normalization */
  .personal-info-form,
  .experience-form,
  .skills-form,
  .bio-editor-container {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    gap: 16px !important;
  }

  #gdprModal .modal-body {
    overflow: hidden !important;
  }

  #gdprModal .bio-editor-container {
    flex: 1;
    min-height: 0;
  }

  #gdprModal .bio-textarea {
    flex: 1;
    height: 100%;
    min-height: 0;
    resize: none;
  }

  /* Label size normalization */
  .form-field label,
  .bio-editor-container label {
    font-size: 16px !important;
  }

  /* Input height normalization */
  .form-field input[type="text"],
  .form-field input[type="email"],
  .form-field textarea {
    padding: 10px 12px !important;
    font-size: 16px !important;
  }

  /* Adjust lists within modals */
  .projects-list-container,
  .experience-list-container {
    height: auto !important;
    padding: 8px 0 !important;
  }

  /* Skills list container needs fixed height for scrolling */
  .skills-list-container {
    height: 100% !important;
    padding: 8px 0 !important;
    overflow: hidden;
  }

  /* Fix grid layouts in list modals */
  .projects-list {
    grid-template-columns: 1fr !important;
    gap: 12px;
  }

  .skills-list {
    flex-direction: column;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    flex: 1;
    min-height: 0;
  }
}

/* Mobile Layout Adjustments */
@media (max-width: 768px) {
  /* Hide button-group on mobile to match tablet behavior */
  /* This prevents toggle position from jumping when switching Editor/Preview */
  .button-group.button-row {
    display: none;
  }

  .button-group.button-row .button-with-label:first-child {
    grid-column: 1;
  }

  .button-group.button-row .photo-upload-wrapper {
    grid-column: 2;
  }

  .button-group.button-row .button-with-label:last-child {
    grid-column: 1 / -1; /* Import JSON spans full width */
  }

  .button-group.button-row .button-with-label,
  .button-group.button-row .photo-upload-wrapper {
    width: 100%;
    max-width: 100%;
  }

  .button-with-label,
  .photo-upload-wrapper {
    min-height: auto;
    margin-bottom: 0;
  }

  /* When photo is uploaded, both action buttons in photo-upload-wrapper */
  .photo-upload-wrapper {
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: stretch;
  }

  /* Hide label on mobile for cleaner layout */
  .button-group.button-row .button-label {
    display: none;
  }

  /* Keep photo upload aspect ratio label visible on all layouts */
  .button-group.button-row #photoUploadLabel {
    display: block;
  }

  /* Larger touch targets for buttons */
  .btn {
    min-height: 48px;
  }

  /* Adjust status message spacing on mobile - more above, less below */
  .status-message {
    margin-top: 6px;
    margin-bottom: 0;
  }

  /* Logo Links - Keep on one line */
  .logo-links-row {
    flex-direction: row;
    align-items: center;
    flex-wrap: nowrap;
    width: 100%;
    gap: 6px;
  }

  .header-actions .gallery-dropdown-wrapper {
    flex: 1 1 0;
    width: auto; /* flex-basis:0 governs flex context; auto fills grid cells correctly */
    min-width: 0;
    max-width: none;
  }

  .header-actions .gallery-link,
  .mobile-import-json-btn {
    display: flex;
    padding: 7px 10px;
    font-size: 13.5px;
    height: 39px;
    min-height: 39px;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1 1 0;
    width: 100%;
    max-width: none;
    min-width: 0;
    white-space: nowrap;
    font-weight: 600;
  }

  .header-actions .gallery-link i,
  .mobile-import-json-btn i {
    font-size: 15px;
    flex-shrink: 0;
  }

  /* Sidebar Padding */
  .sidebar {
    padding: 16px 12px;
  }

  /* Appearance Toolbar - Fluid positioning */
  .appearance-toolbar {
    position: relative;
    transform: none;
    left: auto;
    top: auto;
    width: 100%;
    max-width: 100%;
    margin-bottom: 16px;
    padding: 0;
    flex-direction: row;
    justify-content: space-between;
    gap: 8px;
  }

  .appearance-toolbar .stacked-form {
    flex: 1;
    width: auto;
  }

  .appearance-toolbar .select-input,
  .appearance-toolbar .dropup,
  .appearance-toolbar .dropup-button {
    width: 100%;
    max-width: none;
  }

  /* Prevent iOS zoom on inputs */
  input[type="text"],
  input[type="email"],
  input[type="number"],
  input[type="tel"],
  input[type="url"],
  select,
  textarea {
    font-size: 16px !important;
  }
}

/* Small Mobile Adjustments */
@media (max-width: 480px) {
  html {
    overflow-x: hidden;
  }

  body {
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* Adjust status message spacing on small mobile - more above, less below */
  .status-message {
    margin-top: 6px;
    margin-bottom: 0;
  }

  body.mobile-preview-mode .sidebar {
    padding: calc(18px + env(safe-area-inset-top, 0px)) 16px 10px;
    gap: 6px;
  }

  body.mobile-preview-mode .sidebar,
  body.mobile-preview-mode .sidebar-scroll {
    /* Both axes must be visible together — if only one is set to visible
       while the other is non-visible, CSS coerces visible → auto, which
       keeps the sidebar as a scroll container and clips the dropdown. */
    overflow-x: visible;
    overflow-y: visible;
  }

  body.mobile-preview-mode .sidebar-scroll {
    height: auto;
    max-height: none;
    flex: 1 1 auto;
  }

  body.mobile-preview-mode .sidebar-header {
    display: none;
  }

  body.mobile-preview-mode .main-content {
    padding: 0;
  }

  /* Row 1: Theme and Color Selectors - ALWAYS VISIBLE */
  body.mobile-preview-mode .mobile-preview-actions {
    display: block !important;
    visibility: visible !important;
    padding: 0 16px !important;
    margin-bottom: 0 !important;
  }

  body.mobile-preview-mode .mobile-preview-actions .appearance-section {
    display: block !important;
    visibility: visible !important;
    margin-bottom: 0 !important;
    gap: 6px !important;
  }

  body.mobile-preview-mode .mobile-preview-actions .appearance-grid {
    display: grid !important;
    visibility: visible !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 12px !important;
  }

  body.mobile-preview-mode .mobile-preview-actions .appearance-grid .select-input,
  body.mobile-preview-mode .mobile-preview-actions .appearance-grid .form-group {
    display: block !important;
    visibility: visible !important;
    width: 100% !important;
  }

  /* Preview header always visible on mobile to show theme/color selectors */
  body.mobile-preview-mode .preview-header {
    display: flex !important;
    margin-top: 2px;
    margin-bottom: 2px;
    padding: 2px 12px;
    min-height: auto;
    border-bottom: none;
  }

  /* Always show appearance toolbar on mobile */
  body.mobile-preview-mode .preview-header .appearance-toolbar {
    display: flex !important;
    gap: 16px;
  }

  /* Add spacing for preview content on mobile */
  body.mobile-preview-mode .preview-container {
    margin-top: 2px;
    min-height: 75vh;
  }

  /* Logo Area - Centered column layout */
  .logo-main {
    flex-direction: column;
    text-align: center;
    gap: 12px;
  }

  .sidebar-header {
    margin-bottom: 0;
    padding-bottom: 0;
  }

  /* Removed logo-heading transform override - uses tablet styles */
  /* Removed header-actions gap override - uses tablet styles */
  /* Removed control-section gap override - uses tablet styles */
  /* Removed mobile-view-toggle-container override - uses tablet styles */

  /* Hide button-group on small mobile to match tablet behavior */
  /* This prevents toggle position from jumping when switching Editor/Preview */
  .button-group.button-row {
    display: none;
  }

  /* Mobile-optimized Gallery Link - Larger and more prominent */
  .header-actions .gallery-dropdown-wrapper {
    flex: 1 1 0;
    width: auto; /* flex-basis:0 governs flex context; auto fills grid cells correctly */
    min-width: 0;
    max-width: none;
  }

  .header-actions .gallery-link {
    display: flex;
    padding: 6px 10px;
    font-size: 13px;
    font-weight: 600;
    border-radius: 8px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease;
    white-space: nowrap;
    height: 38px;
    min-height: 38px;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1 1 0;
    width: 100%;
    max-width: none;
    min-width: 0;
  }

  .header-actions .gallery-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--accent-primary);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    transform: none;
  }

  .header-actions .gallery-link i {
    font-size: 15px;
    flex-shrink: 0;
  }

  /* Mobile Import JSON button - Compact */
  .mobile-import-json-btn {
    display: flex;
    padding: 6px 10px;
    font-size: 13px;
    font-weight: 600;
    border-radius: 8px;
    white-space: nowrap;
    height: 38px;
    min-height: 38px;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex: 1 1 0;
    width: 0;
    max-width: none;
    min-width: 0;
  }

  .mobile-import-json-btn i {
    font-size: 15px;
    flex-shrink: 0;
  }

  .mobile-import-text {
    font-size: 13px;
    font-weight: 600;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Hide original Import JSON on mobile */
  .button-group.button-row .button-with-label:last-child {
    display: none;
  }

  /* Mobile-optimized Mode Switcher */
  .header-actions .mode-switcher {
    position: absolute;
    top: -100px;
    right: 12px;
    padding-right: 0;
    margin-left: 0;
    z-index: 3000;
    transform: none;
  }

  .header-actions .mode-switcher-toggle {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    border: 2px solid var(--mode-switcher-border);
    background: var(--bg-tertiary);
    box-shadow: 0 4px 12px var(--shadow);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .header-actions .mode-switcher-toggle:hover,
  .header-actions .mode-switcher:focus-within .mode-switcher-toggle {
    border-color: var(--accent-hover);
    box-shadow: 0 6px 16px rgba(100, 181, 246, 0.3);
    transform: translateY(-2px);
  }

  .header-actions .mode-switcher-toggle svg {
    width: 26px;
    height: 26px;
  }

  .header-actions .mode-switcher-toggle img.mode-switcher-icon-img {
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }

  /* Dark mode mobile overrides */
  [data-mode="dark"] .header-actions .gallery-link {
    background: linear-gradient(135deg, rgba(100, 181, 246, 0.15), rgba(66, 165, 245, 0.08));
    border-color: rgba(100, 181, 246, 0.3);
    box-shadow: 0 4px 12px rgba(66, 165, 245, 0.2);
    backdrop-filter: blur(10px);
    color: #e3f2fd;
  }

  [data-mode="dark"] .header-actions .mode-switcher-toggle,
  [data-mode="dark"] .mobile-import-json-btn {
    background: var(--bg-tertiary);
    border-color: var(--mode-switcher-border);
    box-shadow: 0 2px 8px var(--shadow);
  }

  [data-mode="dark"] .header-actions .gallery-link:hover {
    background: linear-gradient(135deg, rgba(100, 181, 246, 0.25), rgba(66, 165, 245, 0.15));
    border-color: rgba(100, 181, 246, 0.5);
    box-shadow: 0 6px 16px rgba(66, 165, 245, 0.35);
    color: #ffffff;
  }

  [data-mode="dark"] .header-actions .mode-switcher-toggle:hover,
  [data-mode="dark"] .mobile-import-json-btn:hover {
    border-color: var(--accent-hover);
    box-shadow: 0 4px 16px rgba(100, 181, 246, 0.35), 0 0 0 4px rgba(100, 181, 246, 0.1);
  }

  /* Hacker mode mobile overrides */
  [data-mode="hacker"] .header-actions .gallery-link {
    background: linear-gradient(135deg, rgba(123, 228, 149, 0.15), rgba(82, 201, 122, 0.08));
    border-color: rgba(123, 228, 149, 0.3);
    box-shadow: 0 4px 12px rgba(82, 201, 122, 0.2);
    backdrop-filter: blur(10px);
    color: #d9ffe8;
  }

  [data-mode="hacker"] .header-actions .mode-switcher-toggle,
  [data-mode="hacker"] .mobile-import-json-btn {
    background: var(--bg-tertiary);
    border-color: var(--mode-switcher-border);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
  }

  [data-mode="hacker"] .header-actions .gallery-link:hover {
    background: linear-gradient(135deg, rgba(123, 228, 149, 0.25), rgba(82, 201, 122, 0.15));
    border-color: rgba(123, 228, 149, 0.5);
    box-shadow: 0 6px 16px rgba(82, 201, 122, 0.35);
    color: #ffffff;
  }

  [data-mode="hacker"] .header-actions .mode-switcher-toggle:hover,
  [data-mode="hacker"] .mobile-import-json-btn:hover {
    border-color: var(--accent-hover);
    box-shadow: 0 4px 16px rgba(82, 201, 122, 0.4), 0 0 0 4px rgba(82, 201, 122, 0.12);
  }

  /* Light mode mobile overrides */
  [data-mode="light"] .header-actions .gallery-link {
    background: linear-gradient(135deg, rgba(100, 181, 246, 0.12), rgba(66, 165, 245, 0.06));
    border-color: rgba(66, 165, 245, 0.3);
    box-shadow: 0 4px 12px rgba(66, 165, 245, 0.15);
    backdrop-filter: blur(10px);
    color: #1565c0;
  }

  [data-mode="light"] .header-actions .mode-switcher-toggle,
  [data-mode="light"] .mobile-import-json-btn {
    background: var(--bg-secondary);
    border-color: var(--mode-switcher-border);
    box-shadow: 0 2px 8px rgba(45, 45, 50, 0.06);
  }

  [data-mode="light"] .header-actions .gallery-link:hover {
    background: linear-gradient(135deg, rgba(100, 181, 246, 0.2), rgba(66, 165, 245, 0.12));
    border-color: rgba(66, 165, 245, 0.5);
    box-shadow: 0 6px 16px rgba(66, 165, 245, 0.25);
    color: #0d47a1;
  }

  [data-mode="light"] .header-actions .mode-switcher-toggle:hover,
  [data-mode="light"] .mobile-import-json-btn:hover {
    border-color: var(--accent-hover);
    box-shadow: 0 4px 16px rgba(74, 138, 196, 0.25), 0 0 0 4px rgba(74, 138, 196, 0.08);
  }

  /* Adjust mode switcher menu position on mobile */
  .header-actions .mode-switcher-menu {
    right: 0;
    left: auto;
    top: calc(100% + 12px);
    transform: translateY(0);
  }

  /* Modal Headers - Prevent wrap, handle long titles */
  .modal-header {
    flex-wrap: nowrap !important;
    gap: 12px;
    padding: 12px 16px;
    justify-content: space-between;
  }

  .modal-header h2 {
    font-size: 17px;
    margin: 0;
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block !important;
  }

  .modal-header .modal-close {
    flex-shrink: 0;
    margin-left: auto;
  }
  
  .btn-rename-section-modal {
    margin-left: 8px;
    flex-shrink: 0;
  }

  /* Modal Footers - Single row buttons */
  .modal-footer {
    flex-direction: row;
    height: auto;
    min-height: auto;
    padding: 12px 16px;
    gap: 10px;
  }

  .modal-footer-left,
  .modal-footer-right {
    position: static;
    transform: none;
    width: auto;
    justify-content: center;
    display: flex;
    gap: 10px;
    flex: 1;
  }

  .modal-footer .btn {
    width: auto;
    flex: 1;
    height: 44px;
    min-height: 44px;
    min-width: 0;
  }

  /* Date Inputs - Keep side by side if possible, but fluid */
  .date-input-group {
    display: flex;
    gap: 8px;
  }
  
  .date-part-year {
    flex: 1.5;
  }
  
  .date-part-month {
    flex: 1;
  }

  /* Experience & Education Items - Reorder handle in row with content */
  .experience-list-item {
    flex-direction: row !important;
    align-items: center !important;
    gap: 10px !important;
    padding: 12px !important;
    width: 100% !important;
  }

  .experience-drag-handle {
    margin-right: 0 !important;
    padding-top: 0 !important;
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }

  .experience-list-item-info {
    flex: 1;
    min-width: 0;
  }

  .experience-list-item-controls {
    width: auto !important;
    margin-top: 0 !important;
    border-top: none !important;
    padding-top: 0 !important;
    align-self: center;
    flex-shrink: 0;
  }
}

/* Mobile/Tablet View Toggle - Segmented Control Design */
.mobile-view-toggle-container {
  display: none;
  width: 100%;
  margin-top: 0;
}

.mobile-editor-actions {
  display: none;
  width: 100%;
  max-width: 480px;
  margin: 0 auto;
  padding: 0;
  gap: 10px;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  align-items: stretch;
  justify-items: stretch;
}

.mobile-editor-actions .btn {
  width: 100%;
}

.mobile-toggle-header {
  display: none; /* Removed redundant header */
}

.mobile-toggle-title {
  display: none;
}

.mobile-toggle-current {
  display: none;
}

/* Segmented Control Container */
.mobile-toggle-button {
  display: none; /* Hide old button - we'll use the container differently */
}

/* Create new segmented control using the container */
.mobile-view-toggle-container {
  display: none;
  width: 100%;
  margin-top: 0;
  padding: 4px;
  background: var(--bg-tertiary, rgba(0, 0, 0, 0.2));
  border-radius: 10px;
  position: relative;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
}

/* Hide mobile status on desktop - only show on tablet/mobile */
.mobile-status {
  display: none;
}

/* We'll create a wrapper for the segmented control */
.mobile-view-toggle-wrapper {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px;
  position: relative;
}

.mobile-view-option {
  padding: 12px 16px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  z-index: 1;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  text-align: center;
}

.mobile-view-option i {
  font-size: 16px;
}

.mobile-view-option.active {
  background: var(--bg-primary);
  color: var(--text-primary);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15),
              0 1px 2px rgba(0, 0, 0, 0.1);
}

.mobile-view-option:not(.active):hover {
  color: var(--text-primary);
}

/* Hacker mode accent */
[data-mode="hacker"] .mobile-view-option.active {
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.25),
              0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Dark mode - Better visibility */
[data-mode="dark"] .mobile-view-toggle-container {
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid var(--border-color);
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
}

[data-mode="dark"] .mobile-view-option.active {
  background: var(--bg-secondary);
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3),
              0 1px 3px rgba(0, 0, 0, 0.2);
}

/* Hacker mode - Better visibility with green accent */
[data-mode="hacker"] .mobile-view-toggle-container {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(76, 175, 80, 0.3);
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4),
              0 0 10px rgba(76, 175, 80, 0.1);
}

[data-mode="hacker"] .mobile-view-option.active {
  background: var(--bg-secondary);
  box-shadow: 0 2px 10px rgba(76, 175, 80, 0.3),
              0 1px 3px rgba(0, 0, 0, 0.2),
              0 0 20px rgba(76, 175, 80, 0.15);
}

[data-mode="hacker"] .mobile-view-option:not(.active) {
  color: rgba(76, 175, 80, 0.6);
}

[data-mode="hacker"] .mobile-view-option:not(.active):hover {
  color: rgba(76, 175, 80, 0.9);
}

/* Legacy button styles - keep for backwards compatibility but hide */
.mobile-toggle-button {
  display: none !important;
}

/* Hide mobile preview actions on desktop, show desktop versions */
.mobile-preview-actions {
  display: none;
}

.desktop-terms,
.desktop-export-buttons {
  display: block;
}

/* Keep button row in one line on desktop */
@media (min-width: 1025px) {
  .button-group.button-row {
    flex-wrap: nowrap;
    gap: 12px;
  }

  .button-group.button-row .button-with-label,
  .button-group.button-row .photo-upload-wrapper {
    flex: 1 1 0;
    width: auto;
    min-width: 0;
  }

  /* Desktop-only: Align appearance toolbar to the left */
  .appearance-toolbar {
    left: 0;
    transform: translateY(-65%);
    justify-content: flex-start;
    width: auto;
  }
}

/* Tablet-only: Add spacing to prevent selector overlap with preview */
@media (min-width: 769px) and (max-width: 1024px) {
  /* Add padding to preview-header to contain selectors and labels properly */
  .preview-header {
    padding-top: 20px;
    padding-bottom: 80px;
  }

  /* Keep appearance toolbar in normal flow to avoid overlapping preview */
  .appearance-toolbar {
    position: relative;
    left: auto;
    top: auto;
    transform: none;
    width: 100%;
    max-width: 560px;
    margin: 0 auto 12px;
    justify-content: center;
  }

  /* Gallery and Import JSON buttons in grid layout above Editor/Preview */
  .header-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
  }

  .header-actions .gallery-link,
  .mobile-import-json-btn {
    width: 100%;
    flex: 1;
  }

  /* Match the gap in mobile-view-toggle-wrapper */
  .mobile-view-toggle-wrapper {
    gap: 4px;
  }

  /* Add gap between Gallery/Import JSON and Editor/Preview */
  .mobile-view-toggle-container {
    margin-top: 16px;
  }
}

/* Mobile-only (not small mobile): Same layout as tablet */
@media (min-width: 481px) and (max-width: 768px) {
  /* Gallery and Import JSON buttons in grid layout above Editor/Preview */
  .header-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
  }

  .header-actions .gallery-link,
  .mobile-import-json-btn {
    width: 100%;
    flex: 1;
  }

  /* Match the gap in mobile-view-toggle-wrapper */
  .mobile-view-toggle-wrapper {
    gap: 4px;
  }

  /* Add gap between Gallery/Import JSON and Editor/Preview */
  .mobile-view-toggle-container {
    margin-top: 16px;
  }
}

/* Show toggle button only on mobile/tablet (1024px and below) */
@media (max-width: 1024px) {
  .mobile-view-toggle-container {
    display: block !important;
    max-width: 480px;
    margin-left: auto;
    margin-right: auto;
  }

  .mobile-editor-actions {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    max-width: 480px;
    margin: 0 auto;
    padding: 0;
    align-items: stretch;
  }

  #mobileEditorActions.mobile-editor-actions {
    margin-top: 0;
    margin-bottom: 0;
    padding-top: 0;
    padding-bottom: 0;
  }

  .mobile-editor-actions > * {
    min-width: 0;
    width: 100%;
  }

  .mobile-editor-actions .photo-upload-wrapper {
    width: 100%;
    justify-content: flex-end;
    gap: 0;
  }

  /* Mobile/Tablet Status Messages in Sidebar */
  .mobile-status {
    display: block;
    margin: 0 auto;
    max-width: 480px;
    text-align: center;
    min-height: 20px;
    /* Reserve space even when empty */
    visibility: visible;
    /* Override preview-status padding to maintain consistent spacing */
    padding: 0 12px;
    /* Vertically center text within reserved height */
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1.2;
  }

  .mobile-editor-actions .button-with-label,
  .mobile-editor-actions .photo-upload-wrapper {
    min-height: 0;
  }

  .mobile-editor-actions #photoUploadLabel {
    display: none;
  }

  /* Reduce status-message spacing on mobile/tablet */
  .status-message {
    padding: 2px 4px;
    margin: 2px 0;
  }

  /* Hide mobile status in Preview mode */
  body.mobile-preview-mode .mobile-status {
    display: none !important;
  }

  /* Hide preview-header status on mobile/tablet */
  .preview-header .preview-status {
    display: none !important;
  }

  /* Hide desktop versions on mobile */
  .desktop-terms,
  .desktop-export-buttons {
    display: none !important;
  }

  /* By default on mobile (editor mode): hide preview and mobile-preview-actions */
  .main-content {
    display: none;
  }

  .mobile-preview-actions {
    display: none;
  }

  .mobile-preview-actions .export-row {
    margin-top: 16px;
  }

  /* When in preview mode: hide editor sections, show preview + terms + export */
  body.mobile-preview-mode .sections-panel {
    display: none !important;
  }

  body.mobile-preview-mode .appearance-section {
    display: none !important;
  }

  body.mobile-preview-mode {
    overflow-y: auto;
    overflow-x: hidden;
    min-height: 100vh;
    height: auto;
  }

  body.mobile-preview-mode .container {
    min-height: 100vh;
    height: auto;
    overflow: visible;
  }

  body.mobile-preview-mode .main-content {
    display: flex !important;
    flex-direction: column;
    flex: 1;
    min-height: 0;
    padding: 0;
  }

  body.mobile-preview-mode .preview-header {
    flex-shrink: 0;
    margin-bottom: 2px;
    padding-left: 12px;
    padding-right: 12px;
    padding-bottom: 2px;
    padding-top: 2px;
    min-height: 0;
  }

  body.mobile-preview-mode .preview-container {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    /* Hide scrollbar while keeping scroll functionality */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  body.mobile-preview-mode .preview-container::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  body.mobile-preview-mode .mobile-preview-actions {
    flex-shrink: 0;
  }

  /* Row 1: Theme and Color Selectors - ALWAYS VISIBLE */
  body.mobile-preview-mode .mobile-preview-actions {
    display: block !important;
    padding: 0 16px !important;
    margin-bottom: 0 !important;
  }

  body.mobile-preview-mode .mobile-preview-actions .appearance-section {
    display: block !important;
    visibility: visible !important;
    margin-bottom: 0 !important;
  }

  body.mobile-preview-mode .mobile-preview-actions .watermark-checkbox-inline:not(.terms-checkbox-inline) {
    display: none;
  }

  body.mobile-preview-mode .mobile-preview-actions .watermark-checkbox-inline.terms-checkbox-inline {
    margin: 4px 0 2px;
  }

  body.mobile-preview-mode .mobile-preview-actions .export-row {
    margin-top: 6px;
  }

  /* Preview header always visible on mobile to show theme/color selectors */
  body.mobile-preview-mode .preview-header {
    display: flex !important;
    margin-top: 2px;
    margin-bottom: 2px;
    padding: 2px 12px;
    min-height: auto;
    border-bottom: none;
  }

  /* Always show appearance toolbar on mobile */
  body.mobile-preview-mode .preview-header .appearance-toolbar {
    display: flex !important;
    gap: 16px;
  }

  /* Add spacing for preview content on mobile */
  body.mobile-preview-mode .preview-container {
    margin-top: 2px;
    min-height: 75vh;
  }

  /* Keep the toggle visible in both modes */
  body.mobile-preview-mode .mobile-view-toggle-container {
    display: block !important;
  }

  body.mobile-preview-mode .mobile-editor-actions {
    display: none !important;
  }

  body.mobile-preview-mode .sidebar {
    padding: calc(18px + env(safe-area-inset-top, 0px)) 16px 10px;
    gap: 6px;
  }

  body.mobile-preview-mode .sidebar-header {
    display: block !important;
  }

  body.mobile-preview-mode .button-group.button-row {
    display: flex !important;
    flex-wrap: wrap;
    gap: 8px;
  }

  /* Prevent the logo from being shifted upward in Preview mode */
  body.mobile-preview-mode .logo-heading {
    transform: none;
  }

  body.mobile-preview-mode .sidebar,
  body.mobile-preview-mode .sidebar-scroll {
    /* Both axes must be visible together — same reason as the rule above. */
    overflow-x: visible;
    overflow-y: visible;
  }

  body.mobile-preview-mode .sidebar-scroll > .control-section {
    margin-bottom: 4px;
  }

  body.mobile-preview-mode #dataStatus {
    display: none;
  }

  body.mobile-preview-mode .sidebar-scroll {
    overflow-x: hidden;
    height: auto;
    max-height: none;
    flex: 1 1 auto;
  }

  body.mobile-preview-mode .sidebar-scroll > .control-section:first-of-type {
    margin-bottom: 4px;
  }

  body.mobile-preview-mode .sidebar-scroll > .control-section:has(.mobile-view-toggle-container) {
    margin-bottom: 4px !important;
  }

}
